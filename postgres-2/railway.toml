[build]
builder = "dockerfile"
dockerfilePath = "postgres-patroni/Dockerfile"
watchPatterns = ["postgres-patroni/**"]

[deploy]
restartPolicyType = "always"
restartPolicyMaxRetries = 10
numReplicas = 1

[variables]
# PostgreSQL credentials - reference from postgres-1
POSTGRES_USER = "${{postgres-1.POSTGRES_USER}}"
POSTGRES_PASSWORD = "${{postgres-1.POSTGRES_PASSWORD}}"
POSTGRES_DB = "${{postgres-1.POSTGRES_DB}}"

# Patroni configuration
PATRONI_ENABLED = "true"
PATRONI_NAME = "postgres-2"
PATRONI_SCOPE = "railway-pg-ha"
PATRONI_REPLICATION_PASSWORD = "${{postgres-1.PATRONI_REPLICATION_PASSWORD}}"
PATRONI_ETCD_HOSTS = "etcd-1.railway.internal:2379,etcd-2.railway.internal:2379,etcd-3.railway.internal:2379"
